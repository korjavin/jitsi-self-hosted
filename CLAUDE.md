# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a GitOps-based self-hosted Jitsi Meet deployment using Docker Compose. The stack includes all necessary Jitsi services (web frontend, XMPP server, focus component, video bridge).

## Technology Stack

- **Video Conferencing**: Jitsi Meet (web, prosody, jicofo, jvb)
- **Container Orchestration**: Docker Compose
- **Reverse Proxy**: Traefik (external, with automatic SSL)
- **XMPP Server**: Prosody
- **SSL/TLS**: Traefik with automatic certificate management

## Common Commands

### Initial Setup
```bash
# Copy environment template and configure
cp .env.example .env
# Edit .env with your domain and server IP

# Generate strong passwords for internal services
./gen-passwords.sh

# Create config directory (if not exists)
mkdir -p ~/.jitsi-meet-cfg
```

### Deployment Commands
```bash
# Start all services
docker-compose up -d

# Start specific services
docker-compose up -d web prosody jicofo jvb

# Stop all services
docker-compose down

# Stop and remove volumes (WARNING: destroys data)
docker-compose down -v

# View logs
docker-compose logs -f [service_name]
docker-compose logs -f web
docker-compose logs -f jvb
```

### Management Commands
```bash
# Check service status
docker-compose ps

# Restart a specific service
docker-compose restart [service_name]

# Update images and restart
docker-compose pull
docker-compose up -d

# View resource usage
docker stats
```

## Service Architecture

### Jitsi Meet Services
- **web** (port 8000/8443): Frontend interface and nginx proxy
- **prosody** (internal): XMPP server for signaling
- **jicofo** (internal): Conference focus component
- **jvb** (port 10000 UDP, 4443 TCP): Video bridge for media routing


## Configuration Requirements

### Critical Environment Variables
- `JITSI_DOMAIN`: Your root domain (e.g., `jitsi.yourdomain.com`)
- `DOCKER_HOST_ADDRESS`: Server's public IP address
- `JICOFO_COMPONENT_SECRET`: Generated by gen-passwords.sh
- `JICOFO_AUTH_PASSWORD`: Generated by gen-passwords.sh
- `JVB_AUTH_PASSWORD`: Generated by gen-passwords.sh

### Network Requirements
- Port 10000/UDP: JVB media traffic
- Port 4443/TCP: JVB TCP fallback
- Web interface: Handled by Traefik reverse proxy

### Traefik Configuration
The web service is configured with Traefik labels for automatic routing and SSL:
- **Route**: `jitsi.${JITSI_DOMAIN}` (e.g., jitsi.yourdomain.com)
- **SSL**: Automatic certificate generation via Traefik's resolver
- **Network**: Uses external `jitsi-network` for Traefik integration

### Domain Configuration
Set your domain in .env:
```
JITSI_DOMAIN=yourdomain.com
```
This will make Jitsi available at `jitsi.yourdomain.com` via Traefik.

## Security Considerations

- All internal service passwords are auto-generated via gen-passwords.sh
- The .env file contains secrets and is git-ignored
- Portainer requires initial admin user setup on first access
- Consider firewall rules to restrict access to management ports
- Use Let's Encrypt for production deployments

## Troubleshooting

### Common Issues
- Services failing to start: Check that passwords are generated in .env
- External connectivity issues: Verify DOCKER_HOST_ADDRESS and firewall rules
- Audio/video not working: Check UDP port 10000 accessibility
- Certificate issues: Verify domain DNS and Let's Encrypt configuration

### Useful Debugging Commands
```bash
# Check container health
docker-compose ps

# View service logs
docker-compose logs -f web
docker-compose logs -f jvb

# Test network connectivity
docker-compose exec web ping prosody
docker-compose exec jicofo ping prosody
```